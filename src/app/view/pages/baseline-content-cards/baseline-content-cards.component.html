<div class="container py-4">
  <h3 class="mb-4 text-center">📚 Contenus de ligne de base</h3>

  <!-- 🔍 Barre de recherche -->
  <div class="d-flex justify-content-center mb-4">
    <input
      type="text"
      [(ngModel)]="search"
      class="form-control w-50 rounded-pill px-4"
      placeholder="🔍 Rechercher par tâche, critère ou contenu..."
    />
    <button class="btn btn-outline-secondary ms-2" (click)="search = ''">
      Réinitialiser
    </button>
    <button
      class="btn btn-success ms-3"
      *ngIf="auth.isAdmin"
      (click)="router.navigate(['/admin/baseline/new'])"
    >
      ➕ Ajouter un contenu
    </button>
  </div>

  <!-- 🃏 Grid de cartes -->
  <div class="row g-3" *ngIf="!isLoading">
    <div
      class="col-sm-6 col-lg-4 col-xl-3"
      *ngFor="let item of getFilteredBaselineContents()"
    >
      <div class="card baseline-card h-100 shadow-sm" (click)="goToViewer(item.id)">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-dark fw-semibold mb-2">
  {{ item.taskLabel || ('#' + item.abllsTaskId) }}
</h5>

<p class="card-text text-muted small mb-2">
  Critère : {{ item.criteriaLabel || ('#' + item.criteriaId) }}
</p>
          <p class="card-text flex-grow-1">
            {{ item.contentHtml ? (item.contentHtml | slice:0:70) + '...' : '—' }}
          </p>

          <!-- 🔗 Fichier -->
           <button
    class="btn btn-sm btn-outline-primary"
    (click)="viewBaseline(item.id)"
    [disabled]="!item?.id"
  >
    👁️ Voir le fichier
  </button>
          <!-- ⚙️ Actions admin -->
          <div
            class="d-flex justify-content-end gap-2 mt-3"
            *ngIf="auth.isAdmin"
            (click)="$event.stopPropagation()"
          >
            <button
              class="btn btn-sm btn-outline-warning"
              (click)="editBaseline(item.id)"
            >
              ✏️
            </button>
            <button
              class="btn btn-sm btn-outline-danger"
              (click)="deleteBaseline(item.id)"
            >
              🗑️
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-3">Chargement des contenus...</p>
  </div>

  <div *ngIf="!isLoading && !getFilteredBaselineContents().length" class="text-center text-muted py-5">
    Aucun contenu trouvé.
  </div>
</div>
