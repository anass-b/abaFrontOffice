<div class="container py-4">
  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="p-4 border rounded bg-white shadow-sm">
    <h1 class="text-center mb-4">Cr√©er une t√¢che ABLLS-R</h1>

    <!-- üß© Cat√©gorie -->
    <label>Cat√©gorie :</label>
    <select class="form-select" formControlName="categoryId" (change)="onCategoryChange()">
      <option [ngValue]="null">-- Choisir une cat√©gorie --</option>
      <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
    </select>

    <!-- üß† Domaine -->
    <label class="mt-3">Domaine :</label>
    <select class="form-select" formControlName="domainId" (change)="onDomainChange()">
      <option [ngValue]="null">-- Choisir un domaine --</option>
      <option *ngFor="let dom of filteredDomains" [value]="dom.id">
        {{ dom.name }} (Pr√©fixe : {{ dom.prefix }})
      </option>
    </select>

    <!-- üßæ Num√©ro de t√¢che -->
    <label class="mt-3">Num√©ro de t√¢che :</label>
    <input type="number" formControlName="taskNumber" class="form-control" placeholder="Ex : 3" (input)="onTaskNumberChange()" />

    <!-- üî¢ Code g√©n√©r√© automatiquement -->
    <div class="form-text mt-1 mb-2">Code g√©n√©r√© : <strong>{{ generatedCode }}</strong></div>

    <!-- üìù Nom de la t√¢che -->
    <label>Nom de la t√¢che :</label>
    <input type="text" formControlName="title" placeholder="Associer des objets" class="form-control" />

    <!-- üé• Vid√©o explicative -->
    <label class="mt-3">Vid√©o explicative :</label>
    <select class="form-select" formControlName="explanationUseExternal" (change)="onExplanationTypeChange($event)">
      <option [ngValue]="true">Lien externe</option>
      <option [ngValue]="false">Fichier local</option>
    </select>

    <ng-container *ngIf="taskForm.get('explanationUseExternal')?.value">
      <input type="url" formControlName="explanationVideoUrl" class="form-control mt-2" placeholder="https://..." />
    </ng-container>
    <ng-container *ngIf="!taskForm.get('explanationUseExternal')?.value">
      <input type="file" class="form-control mt-2" (change)="onExplanationVideoFileSelected($event)" />
    </ng-container>

    <!-- üßÆ Nombre de crit√®res -->
    <label class="mt-4">Nombre souhait√© de crit√®res :</label>
    <select class="form-select" [value]="nbCriteres" (change)="onCriteriaCountChange($event)">
      <option [value]="2">2</option>
      <option [value]="3">3</option>
      <option [value]="4">4</option>
    </select>

    <!-- üìã Liste des crit√®res -->
    <label class="mt-4">Liste des crit√®res :</label>
    <table class="table table-bordered table-sm mt-2">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Nom</th>
          <th>R√©ponse attendue</th>
          <th>Vid√©o</th>
          <th>Mat√©riel</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let crit of evaluationCriterias; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ crit.label }}</td>
          <td>{{ crit.expectedResponse }}</td>
          <td>
            <ng-container *ngIf="crit.useExternalDemonstrationVideo">üåê Lien</ng-container>
            <ng-container *ngIf="!crit.useExternalDemonstrationVideo">üìÅ Fichier</ng-container>
          </td>
          <td>{{ crit.materialPhotoIds?.length || 0 }}</td>
          <td>
            <button type="button" class="btn btn-sm btn-outline-danger" (click)="deleteCriteria(i)">Supprimer</button>
          </td>
        </tr>
        <tr *ngIf="evaluationCriterias.length === 0">
          <td colspan="6" class="text-center text-muted">Aucun crit√®re ajout√©</td>
        </tr>
      </tbody>
    </table>

    <!-- ‚ûï Ajouter crit√®re -->
    <div class="text-center mt-3">
      <button type="button" class="btn btn-outline-primary" (click)="openAddCriteriaDialog()"
        [disabled]="evaluationCriterias.length >= nbCriteres">+ Ajouter un crit√®re</button>
    </div>

    <!-- üìå Statut -->
    <div class="mt-3">
      <label>Statut automatique :</label>
      <div class="form-control-plaintext">
        {{ evaluationCriterias.length >= nbCriteres ? '‚úÖ Complet' : 'üïê En cours de cr√©ation' }}
      </div>
    </div>

    <!-- üìù Description -->
    <label class="mt-3">Observations :</label>
    <textarea formControlName="description" rows="3" class="form-control"></textarea>

    <!-- ‚úÖ Bouton submit -->
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-success">‚úÖ Enregistrer la t√¢che</button>
    </div>
  </form>
</div>
