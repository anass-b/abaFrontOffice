<div class="container py-4" *ngIf="!loading && item; else loadingTpl">
  <button class="btn btn-outline-secondary mb-3" (click)="goBack()">← Retour</button>

  <h3 class="mb-2">Contenu de ligne de base</h3>
  <div class="text-muted mb-3">
  Tâche: {{ taskLabel || ('#' + item.abllsTaskId) }}
  •
  Critère: {{ criteriaLabel || ('#' + item.criteriaId) }}
</div>


  <!-- HTML content (if any) -->
  <div *ngIf="item.contentHtml" class="mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <div [innerHTML]="item.contentHtml"></div>
      </div>
    </div>
  </div>

  <!-- File viewer -->
  <ng-container *ngIf="blobUrl; else noFileTpl">
    <!-- PDF via PDF.js -->
    <div *ngIf="isPdf" class="document-frame-wrapper">
      <iframe
        [src]="(pdfViewerUrl ?? '' ) | safeUrl"
        width="100%"
        height="800"
        style="border:none;"
      ></iframe>
    </div>

    <!-- Images -->
    <div *ngIf="isImage" class="image-wrapper">
      <img [src]="blobUrl | safeUrl" class="img-fluid rounded shadow-sm" alt="baseline file">
    </div>

    <!-- Fallback: download link -->
    <div *ngIf="!isPdf && !isImage" class="mt-3">
      <a [href]="blobUrl | safeUrl" download class="btn btn-primary">Télécharger le fichier</a>
    </div>
  </ng-container>
</div>

<ng-template #loadingTpl>
  <div class="container py-5 text-center text-muted">
    <div class="spinner-border" role="status"></div>
    <div class="mt-2">Chargement…</div>
  </div>
</ng-template>

<ng-template #noFileTpl>
  <div class="alert alert-warning">Aucun fichier associé à ce contenu.</div>
</ng-template>

<div *ngIf="error" class="container mt-3">
  <div class="alert alert-danger">{{ error }}</div>
</div>
