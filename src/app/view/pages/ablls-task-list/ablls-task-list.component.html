  <div class="container py-4">
    <h1 class="mb-3 text-center">Taches ABLLS-R</h1>

    <!-- Champ de recherche dynamique -->
  <div class="input-group mb-4 align-items-center">
      <input
        type="text"
        [(ngModel)]="search"
        (ngModelChange)="onSearchChange($event)"
        class="form-control rounded-start-pill px-4"
        [disabled]="!isReady"
        [placeholder]="selectedDomain ? '🔍 Rechercher une tâche...' : selectedCategory ? '🔍 Rechercher un domaine...' : '🔍 Rechercher une catégorie...'"
      />
      <button class="btn btn-outline-primary px-4" (click)="search = ''">Réinitialiser</button>
      <button
        class="btn btn-success rounded-end-pill px-4 ms-2"
        *ngIf="selectedDomain"
        (click)="goToAddTask()"
      >
        ➕ Ajouter une tâche
      </button>
    </div>

    <!-- 📚 Catégories -->
    <div *ngIf="!selectedCategory && !selectedDomain && isReady">
      <h4 class="mb-3">📚 Catégories ABLLS-R</h4>
      <div class="row">
        <div class="col-md-4 mb-3" *ngFor="let category of getFilteredCategories()">
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <h5 class="card-title">{{ category }}</h5>
              <p class="card-text">{{ getTotalDomainsInCategory(category) }} domaine(s)</p>
              <button class="btn btn-primary btn-sm" (click)="selectCategory(category)">Voir les domaines →</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 📁 Domaines -->
    <div *ngIf="selectedCategory && !selectedDomain">
      <h4 class="mb-3">📁 Domaines de la catégorie : {{ selectedCategory }}</h4>
      <button class="btn btn-outline-secondary rounded-pill px-4 mb-3" (click)="clearCategory()">← Retour aux catégories</button>

      <div class="row">
        <div class="col-12 col-sm-6 col-lg-3 mb-4" *ngFor="let domain of getFilteredDomains()">
          <div class="card h-100 text-white border-0 shadow-sm rounded-4" style="background: linear-gradient(145deg, #1e1e2f, #2c2c3e);">
            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <div class="avatar bg-danger text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 28px; height: 28px; font-weight: bold;">
                  {{ domainMap[domain]?.prefix }}
                </div>
                <h5 class="card-title">{{ domain }}</h5>
                <p class="card-text">{{ groupedByCategory[selectedCategory][domain].length }} tâche(s)</p>
              </div>
              <button class="btn btn-info w-100 rounded-pill mt-3" (click)="selectDomain(domain)">Ouvrir</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 📌 Tâches -->
    <!-- 📌 Tâches -->
  <div *ngIf="selectedDomain">
    <h4 class="mb-3">
      📌
      <ng-container *ngIf="selectedDomain === '__ALL__'; else domainTitle">
        Tâches de la catégorie : {{ selectedCategory }}
      </ng-container>
      <ng-template #domainTitle>
        Tâches du domaine : {{ selectedDomain }}
      </ng-template>
    </h4>

    <button class="btn btn-outline-secondary rounded-pill px-4 mb-3" (click)="clearDomain()">
      ← Retour aux domaines
    </button>

    <div class="row">
      <div class="col-12 col-sm-6 col-lg-3 mb-4" *ngFor="let task of getFilteredTasks()">
        <div class="card h-100 border-0 shadow-sm rounded-4" (click)="goToDetail(task.id!)">
          <div class="card-body">
            <h5 class="card-title fw-semibold" style="color: rgb(0, 0, 36);">
              {{ task.code }} - {{ task.title }}
            </h5>
            <p class="card-text text-muted mb-2">{{ task.description }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  </div>
