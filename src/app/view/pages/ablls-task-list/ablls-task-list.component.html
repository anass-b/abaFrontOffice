<div class="ablls-list-wrapper container py-4">
  <!-- Titre -->
  <div class="page-head mb-2">
    <h1 class="m-0">ðŸ§© TÃ¢ches ABLLS-R</h1>
  </div>

  <!-- Barre de recherche / actions -->
  <section class="toolbar card border-0 shadow-sm mb-3">
    <div class="tool-row">
      <!-- Recherche -->
      <div class="search">
        <span class="icon">ðŸ”Ž</span>
        <input
          type="text"
          [(ngModel)]="search"
          (ngModelChange)="onSearchChange($event)"
          [disabled]="!isReady"
          placeholder="Rechercher par code, titre, domaine ou catÃ©gorieâ€¦ (ex. B4, Imitation)"
        />
      </div>

      <!-- Actions -->
      <div class="actions">
        <button class="btn ghost" (click)="clearSearch()">â†» RÃ©initialiser</button>
        <button class="btn primary" *ngIf="auth.isAdmin" (click)="goToAddTask()">âž• Ajouter une tÃ¢che</button>
      </div>
    </div>

    <!-- Chips catÃ©gories / domaines -->
    <div class="chips-row">
      <button class="chip" [class.active]="!search" (click)="onSearchChange('')">Tous</button>

      <!-- CatÃ©gories -->
      <ng-container *ngFor="let c of categories">
        <button
          class="chip"
          [class.active]="search?.toLowerCase() === (c.name||'').toLowerCase()"
          (click)="onSearchChange(c.name||'')"
          title="CatÃ©gorie"
        >
          {{ c.name }}
        </button>
      </ng-container>

      <!-- Domaines -->
      <ng-container *ngFor="let d of domains">
        <button
          class="chip soft"
          [class.active]="search?.toLowerCase() === (d.name||'').toLowerCase()"
          (click)="onSearchChange(d.name||'')"
          title="Domaine"
        >
          {{ d.name }}
        </button>
      </ng-container>
    </div>

    <!-- Indication de correspondance -->
    <div class="match-hint" *ngIf="matchedBy">
      RÃ©sultats correspondant au <strong>{{ matchedByLabel[matchedBy!] }}</strong>.
    </div>
  </section>

  <!-- Grille des tÃ¢ches -->
  <section *ngIf="isReady">
    <h4 class="subhead">ðŸ“‹ Toutes les tÃ¢ches ABLLS-R</h4>

    <div class="tasks-grid">
      <article
        class="tcard"
        *ngFor="let task of paginatedTasks"
        (click)="goToDetail(task.id!)"
        tabindex="0"
      >
        <div class="code">{{ task.code }}</div>
        <h3 class="title" [title]="task.title">{{ task.title }}</h3>
        <p class="desc">
          {{ task.description || 'â€”' }}
        </p>

       <div class="chips-compact">
  <!-- Domain tag -->
<span class="badge bg-info-subtle text-dark me-1"
      *ngIf="$any(task).__domainName">
  {{ $any(task).__domainName }}
</span>

<span class="badge bg-warning-subtle text-dark"
      *ngIf="$any(task).__categoryName">
  {{ $any(task).__categoryName }}
</span>


</div>


        <div class="cta-row" (click)="$event.stopPropagation()">
          <button class="btn cta" (click)="goToDetail(task.id!)">Voir la fiche â†’</button>

          <div class="admin" *ngIf="auth.isAdmin">
            <button class="btn outline" (click)="onEdit(task)">Modifier</button>
            <button class="btn danger"  (click)="onDelete(task)">Supprimer</button>
          </div>
        </div>
      </article>
    </div>

    <!-- Pagination -->
    <nav *ngIf="totalPages > 1" class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">Â«</button>
        </li>

        <li
          class="page-item"
          *ngFor="let _ of [].constructor(totalPages); let i = index"
          [class.active]="currentPage === i + 1"
        >
          <button class="page-link" (click)="currentPage = i + 1">{{ i + 1 }}</button>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">Â»</button>
        </li>
      </ul>
    </nav>
  </section>
</div>
